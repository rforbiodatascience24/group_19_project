---
title: "exploring"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

## Victor exploring

Code from working document

```{r}
data <- read.csv("risk_factors_cervical_cancer.csv")
library(tidyverse)
library(dplyr)
data <- data %>%
  mutate(across(where(is.character), ~na_if(., "?")))

data <- data %>%
  mutate(Smokes = case_when(
    Smokes == "0.0" ~ "no",
    Smokes == "1.0" ~ "yes"
  ))
data <- data |> 
  mutate(Hormonal.Contraceptives = case_when(
    Hormonal.Contraceptives == "1.0" ~ "yes",
    Hormonal.Contraceptives == "0.0" ~ "no"))

data <- data |> 
  rename('Smokes.years'= Smokes..years.,
         'Smokes.packs.years' = Smokes..packs.year.) |> 
  mutate(Smokes.years = as.numeric(Smokes.years),
         Smokes.packs.years = as.numeric(Smokes.packs.years))

data  <- data |> 
  mutate(Number.of.sexual.partners = as.integer(Number.of.sexual.partners),
         First.sexual.intercourse = as.integer(First.sexual.intercourse),
         Num.of.pregnancies = as.integer(Num.of.pregnancies))
data <- data %>%
  mutate(ID = row_number()) %>%
  select(ID, everything())

data


data <- data %>% mutate(IUD = case_when(IUD == "0.0" ~ "no",
                                IUD == "1.0" ~ "yes"))
```

Exploring

Plots:

Dx.Cancer vs Age.

```{r}
# convert the cancer column to integers
data$Dx.Cancer <- as.integer(data$Dx.Cancer)
# Useful: Age and cancer diagnosis relation:
data_long |> 
  ggplot()+
  geom_boxplot(mapping = aes(x = Age, y = factor(Dx.Cancer)))
```

Facet wrap so we get all STD types vs Age

Plots:

Age relation to different STDs. Facetted in a nice way

```{r}


data_long <- data %>%
  select(-`STDs..Number.of.diagnosis`, -`STDs..number.`,-`STDs..Time.since.first.diagnosis`, -`STDs..Time.since.last.diagnosis`) %>% # Exclude the column here
  pivot_longer(
    cols = starts_with("STDs"), # Include remaining STDs columns
    names_to = "STDs_type",
    values_to = "STDs_value"
  )

#Useful: facet wrap for STDs_type

data_long |> 
  ggplot()+
  geom_boxplot(mapping = aes( x = Age, y = STDs_value))+
  facet_wrap(~STDs_type, scales = "free_y")

```

Are smokers more at risk of getting STDs:

In this way it could be cool with a confusion matrix for smokers vs STDs

Facet wrap for smokes vs type of STDs

```{r}
#Useful
data_long |> 
  ggplot(aes(x = Smokes, fill = STDs_value)) + 
  geom_bar(position = "dodge")+
  facet_wrap(~STDs_type)

```

Same but hormonal contraceptives and STDs. Here we see the relation between hormonal contraceptives and condylomatosis.

Add a column

Want to see if the having STDs is correlated with having cancer

Risk of getting cancer if you have at least one STD vs Risk of getting cancer if you dont have an STD

From the above chunk it looks like there isnt a correlation between having an STD and cervical cancer

Lets look at HPV specifically as diagnosis:Looks like there is a huge correlation between Dx.HPV and cancer. Lets visualize it:

In this chunk we also see correlation of cancer and different STDs.

```{r}
#Useful
ggplot(data_long) +
  geom_bar(mapping = aes(x = factor(Dx.HPV), fill = factor(Dx.Cancer)), position = "fill") +
  labs(x = "HPV Diagnosis", y = "Proportion", fill = "Cancer Diagnosis") +
  scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))

#Useful
data_long |> 
  ggplot(aes(x = factor(Dx.Cancer), fill = STDs_value)) + 
  geom_bar(position = "dodge")+
  facet_wrap(~STDs_type)+
  ylim(0,100)

```

So we see here that actually none of the patients with other STDs than HPV have cancer.

Now we want to see if smokers is correlated with cervical cancer:

```{r}
#Useful
ggplot(data_long) +
  geom_bar(mapping = aes(x = factor(Smokes), fill = factor(Dx.Cancer)), position = "fill") +
  labs(x = "HPV Diagnosis", y = "Proportion", fill = "Cancer Diagnosis") +
  scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))
```

There doesnt seem to be a correlation between smoking and cervical cancer

Lets see if hormonal prevention is:

```{r}
#Useful
ggplot(data_long) +
  geom_bar(mapping = aes(x = factor(Hormonal.Contraceptives), fill = factor(Dx.Cancer)), position = "fill") +
  labs(x = "Hormonal", y = "Proportion", fill = "Cancer Diagnosis") +
  scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))+
  ylim(0,0.05)
```

There seems to be a correlation between taking hormonal contraceptives and cervical cancer.

Lets see if the amount of sexual partners could influence having STD:

```{r}
#


create_proportional_barplot(data_long, "IUD", "Dx.Cancer")

create_proportional_barplot <- function(data, x_var, fill_var, 
                                        x_label = NULL, y_label = "Proportion", 
                                        fill_label = NULL, title = NULL) {
  # Dynamically use variable names if no custom labels are provided
  if (is.null(x_label)) {
    x_label <- x_var
  }
  
  if (is.null(fill_label)) {
    fill_label <- fill_var
  }
  
  if (is.null(title)) {
    title <- paste("Proportion of", fill_var, "by", x_var)
  }
  
  # Convert the fill variable to a factor to avoid grouping issues
  data[[fill_var]] <- as.factor(data[[fill_var]])
  
  # Generate the plot
  ggplot(data, aes(x = .data[[x_var]], fill = .data[[fill_var]])) +
    geom_bar(position = "fill") +
    labs(
      x = x_label,
      y = y_label,
      fill = fill_label,
      title = title
    ) +
    scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 0, hjust = 0.5))
}


```

```         
```

An idea could be to do a package for future data coming in the same way. Maybe if you want to do the studies in more countries. Read the article to see what they do.

Package for making correlation plots for cate. variable:

```         
```
