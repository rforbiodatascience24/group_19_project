---
title: "exploring"
format: html
editor: visual
editor_options: 
  chunk_output_type: console
---

## Victor exploring

Code from working document

```{r}
data <- read.csv("risk_factors_cervical_cancer.csv")
library(tidyverse)
library(dplyr)
data <- data %>%
  mutate(across(where(is.character), ~na_if(., "?")))

data <- data %>%
  mutate(Smokes = case_when(
    Smokes == "0.0" ~ "no",
    Smokes == "1.0" ~ "yes"
  ))
data <- data |> 
  mutate(Hormonal.Contraceptives = case_when(
    Hormonal.Contraceptives == "1.0" ~ "yes",
    Hormonal.Contraceptives == "0.0" ~ "no"))

data <- data |> 
  rename('Smokes.years'= Smokes..years.,
         'Smokes.packs.years' = Smokes..packs.year.) |> 
  mutate(Smokes.years = as.numeric(Smokes.years),
         Smokes.packs.years = as.numeric(Smokes.packs.years))

data  <- data |> 
  mutate(Number.of.sexual.partners = as.integer(Number.of.sexual.partners),
         First.sexual.intercourse = as.integer(First.sexual.intercourse),
         Num.of.pregnancies = as.integer(Num.of.pregnancies))
data <- data %>%
  mutate(ID = row_number()) %>%
  select(ID, everything())

data


data <- data %>% mutate(IUD = case_when(IUD == "0.0" ~ "no",
                                IUD == "1.0" ~ "yes"))
```

Exploring

Plots:

Dx.Cancer vs Age.

\

```{r}
# convert the cancer column to integers
data$Dx.Cancer <- as.integer(data$Dx.Cancer)
# Useful: Age and cancer diagnosis relation:
data_long |> 
  ggplot()+
  geom_boxplot(mapping = aes(x = Age, y = factor(Dx.Cancer)))
# Useful: STD types and age relation across all STDs
data_long |> 
  ggplot()+
  geom_boxplot(mapping = aes(x = Age, y = factor(STDs_type)))+
  facet_wrap(~STDs_value)

```

Facet wrap so we get all STD types vs Age

Plots:

Age relation to different STDs. Facetted in a nice way

```{r}


data_long <- data %>%
  select(-`STDs..Number.of.diagnosis`, -`STDs..number.`,-`STDs..Time.since.first.diagnosis`, -`STDs..Time.since.last.diagnosis`) %>% # Exclude the column here
  pivot_longer(
    cols = starts_with("STDs"), # Include remaining STDs columns
    names_to = "STDs_type",
    values_to = "STDs_value"
  )

#Useful: facet wrap for STDs_type

data_long |> 
  ggplot()+
  geom_boxplot(mapping = aes( x = Age, y = STDs_value))+
  facet_wrap(~STDs_type, scales = "free_y")
# How many of the that smoke also have STDS
# Useful to calculate proportions
xx <- data |> 
  filter(STDs == "1.0", Smokes == "yes") |> 
  summarize(count=n())
# How many of them that 
xx1 <- data |> 
  filter(!is.na(STDs), Smokes == "yes") |> 
  summarize(count=n())
# so if you are a smoker oddsratio of getting STDs are:
xx$count/xx1$count


# now for none smokers:
xx_non <- data |> 
  filter(STDs == "1.0", Smokes == "no") |> 
  summarize(count=n())
# How many of them that 
xx1_non <- data |> 
  filter(!is.na(STDs), Smokes == "no") |> 
  summarize(count=n())
xx_non$count/xx1_non$count
```

Are smokers more at risk of getting STDs:

We could do facet wrap of the data and use the numbers to calculate the different percentages. There must be a way to plot the percentage of STD positives for smokers and not smokers.

```{r}
xx <- data |> 
  filter(STDs == "1.0", Smokes == "yes") |> 
  summarize(count=n())
# How many of them that 
xx1 <- data |> 
  filter(!is.na(STDs), Smokes == "yes") |> 
  summarize(count=n())
# so if you are a smoker chance of getting STDs are:
xx$count/xx1$count


# now for none smokers:
xx_non <- data |> 
  filter(STDs == "1.0", Smokes == "no") |> 
  summarize(count=n())
# How many of them that 
xx1_non <- data |> 
  filter(!is.na(STDs), Smokes == "no") |> 
  summarize(count=n())
xx_non$count/xx1_non$count


```

In this way it could be cool with a confusion matrix for smokers vs STDs

Are women on contraceptives in higher risk of getting STDs

```{r}
xx_contra <- data |> 
  filter(STDs == "1.0", Hormonal.Contraceptives == "yes") |> 
  summarize(count=n())
# How many of them that 
xx1_contra <- data |> 
  filter(!is.na(STDs), Hormonal.Contraceptives == "yes") |> 
  summarize(count=n())
# so if you are a contraceptive chance of getting STDs are:
xx_contra$count/xx1_contra$count


# now for none contraceptives:
xx_non_contra <- data |> 
  filter(STDs == "1.0", Hormonal.Contraceptives == "no") |> 
  summarize(count=n())
# How many of them that 
xx1_non_contra <- data |> 
  filter(!is.na(STDs), Hormonal.Contraceptives == "no") |> 
  summarize(count=n())
xx_non_contra$count/xx1_non_contra$count


```

Facet wrap for smokes vs type of STDs

```{r}
#Useful
data_long |> 
  ggplot(aes(x = Smokes, fill = STDs_value)) + 
  geom_bar(position = "dodge")+
  facet_wrap(~STDs_type)
```

Same but hormonal contraceptives and STDs. Here we see the relation between hormonal contraceptives and condylomatosis.

```{r}
#Useful
data_long |> 
  ggplot(aes(x = Hormonal.Contraceptives, fill = STDs_value)) + 
  geom_bar(position = "dodge")+
  facet_wrap(~STDs_type)
```

A plot of smokes vs STDs yes or no

```{r}


data_long |> 
  ggplot(aes(x = Smokes, fill = factor(STDs_value))) + 
  geom_bar(position = "dodge")

```

A plot of contraception vs STDs. Nothing interesting here:

```{r}
data |> 
  ggplot(aes(x = First.sexual.intercourse, fill = STDs)) + 
  geom_bar(position = "dodge")
# instead of counts i want the proportion

```

Add a column

Want to see if the having STDs is correlated with having cancer

Risk of getting cancer if you have at least one STD vs Risk of getting cancer if you dont have an STD

```{r}

xx_cancer <- data |> 
  filter(Dx.Cancer == 1, STDs == "1.0") |> 
  summarize(count=n())
# How many of them that 
xx1_cancer <- data |> 
  filter(!is.na(Dx.Cancer),STDs == "1.0") |> 
  summarize(count=n())
# so if you are a smoker chance of getting STDs are:
xx_cancer$count/xx1_cancer$count


# now for none smokers:
xx_non_std <- data |> 
  filter(Dx.Cancer == 1, STDs == "0.0") |> 
  summarize(count=n())
# How many of them that 
xx1_non_std <- data |> 
  filter(!is.na(Dx.Cancer), STDs == "0.0") |> 
  summarize(count=n())
xx_non_std$count/xx1_non_std$count

```

From the above chunk it looks like there isnt a correlation between having an STD and cervical cancer

Lets look at HPV specifically as diagnosis:

```{r}
xx_cancer_hpv <- data |> 
  filter(Dx.Cancer == 1, Dx.HPV == 1) |> 
  summarize(count=n())
# How many of them that 
xx1_cancer_hpv <- data |> 
  filter(!is.na(Dx.Cancer),Dx.HPV == 1) |> 
  summarize(count=n())
# so if you are a smoker chance of getting STDs are:
xx_cancer_hpv$count/xx1_cancer_hpv$count


# now for none smokers:
xx_non_std_hpv <- data |> 
  filter(Dx.Cancer == 1, Dx.HPV == 0) |> 
  summarize(count=n())
# How many of them that 
xx1_non_std_hpv <- data |> 
  filter(!is.na(Dx.Cancer), Dx.HPV == 0) |> 
  summarize(count=n())
xx_non_std_hpv$count/xx1_non_std_hpv$count

```

Looks like there is a huge correlation between Dx.HPV and cancer. Lets visualize it:

In this chunk we also see correlation of cancer and different STDs.

```{r}
#Useful
ggplot(data_long) +
  geom_bar(mapping = aes(x = factor(Dx.HPV), fill = factor(Dx.Cancer)), position = "fill") +
  labs(x = "HPV Diagnosis", y = "Proportion", fill = "Cancer Diagnosis") +
  scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))

#Useful
data_long |> 
  ggplot(aes(x = factor(Dx.Cancer), fill = STDs_value)) + 
  geom_bar(position = "dodge")+
  facet_wrap(~STDs_type)+
  ylim(0,100)

```

So we see here that actually none of the patients with other STDs than HPV have cancer.

Now we want to see if smokers is correlated with cervical cancer:

```{r}
#Useful
ggplot(data_long) +
  geom_bar(mapping = aes(x = factor(Smokes), fill = factor(Dx.Cancer)), position = "fill") +
  labs(x = "HPV Diagnosis", y = "Proportion", fill = "Cancer Diagnosis") +
  scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))
```

There doesnt seem to be a correlation between smoking and cervical cancer

Lets see if hormonal prevention is:

```{r}
#Useful
ggplot(data_long) +
  geom_bar(mapping = aes(x = factor(Hormonal.Contraceptives), fill = factor(Dx.Cancer)), position = "fill") +
  labs(x = "Hormonal", y = "Proportion", fill = "Cancer Diagnosis") +
  scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))+
  ylim(0,0.05)
```

There seems to be a correlation between taking hormonal contraceptives and cervical cancer.

Lets see if the amount of sexual partners could influence having STD:

```{r}
#
ggplot(data) +
  geom_bar(mapping = aes(x = factor(STDs), fill = factor(Number.of.sexual.partners)), position = "fill") +
  labs(x = "HPV Diagnosis", y = "Proportion", fill = "Cancer Diagnosis") +
  scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 0, hjust = 0.5))

create_proportional_barplot(data_long, "IUD", "Dx.Cancer")

create_proportional_barplot <- function(data, x_var, fill_var, 
                                        x_label = NULL, y_label = "Proportion", 
                                        fill_label = NULL, title = NULL) {
  # Dynamically use variable names if no custom labels are provided
  if (is.null(x_label)) {
    x_label <- x_var
  }
  
  if (is.null(fill_label)) {
    fill_label <- fill_var
  }
  
  if (is.null(title)) {
    title <- paste("Proportion of", fill_var, "by", x_var)
  }
  
  # Convert the fill variable to a factor to avoid grouping issues
  data[[fill_var]] <- as.factor(data[[fill_var]])
  
  # Generate the plot
  ggplot(data, aes(x = .data[[x_var]], fill = .data[[fill_var]])) +
    geom_bar(position = "fill") +
    labs(
      x = x_label,
      y = y_label,
      fill = fill_label,
      title = title
    ) +
    scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 0, hjust = 0.5))
}


```

```{create_proportional_barplot <- function(data, x_var, fill_var,}
                                        x_label = NULL, y_label = "Proportion", 
                                        fill_label = NULL, title = NULL) {
  # Dynamically use variable names if no custom labels are provided
  x_label <- x_label %||% x_var
  fill_label <- fill_label %||% fill_var
  title <- title %||% paste("Proportion of", fill_var, "by", x_var)
  
  # Generate the plot
  ggplot(data, aes(x = .data[[x_var]], fill = .data[[fill_var]])) +
    geom_bar(position = "fill") +
    labs(
      x = x_label,
      y = y_label,
      fill = fill_label,
      title = title
    ) +
    scale_fill_manual(values = c("0" = "lightblue", "1" = "darkred")) +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 0, hjust = 0.5))
}


```

An idea could be to do a package for future data coming in the same way. Maybe if you want to do the studies in more countries. Read the article to see what they do.

Package for making correlation plots for cate. variable:

```         
```
